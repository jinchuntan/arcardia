<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>ARCardia • Scan</title>
    <style>
      :root{
        --edge: clamp(12px, 2.2vw, 18px);
        --panelW: 380px;
      }

      *{ box-sizing:border-box; }
      html, body { height: 100%; }
      body { margin:0; background:#05060a; overflow:hidden; }
      canvas, video { display:block; }

      /* Camera video full-screen */
      video{
        position: fixed;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 0;
      }
      canvas{
        position: fixed;
        inset: 0;
        z-index: 1;
      }

      /* UI overlay */
      #ar-ui{
        position: fixed;
        inset: 0;
        z-index: 10;
        pointer-events: none;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        color: #fff;
      }

      #panel{
        position: absolute;

        /* Safe-area aware top-right anchor */
        top: calc(var(--edge) + env(safe-area-inset-top));
        right: calc(var(--edge) + env(safe-area-inset-right));

        width: min(var(--panelW), calc(100% - (2 * var(--edge)) - env(safe-area-inset-left) - env(safe-area-inset-right)));
        max-height: calc(100dvh - (2 * var(--edge)) - env(safe-area-inset-top) - env(safe-area-inset-bottom));

        overflow:auto;
        -webkit-overflow-scrolling: touch;

        background: rgba(0,0,0,0.60);
        border: 1px solid rgba(255,255,255,0.15);
        border-radius: 14px;
        padding: 14px;
        pointer-events: auto;
        backdrop-filter: blur(8px);
      }

      #cardTitle{ font-weight: 950; font-size: clamp(14px, 2vw, 16px); }
      #cardCategory{ opacity: 0.85; font-size: 13px; margin-top: 2px; }

      #cardFacts{
        margin-top: 12px;
        line-height: 1.45;
        font-size: clamp(13px, 1.8vw, 14px);
        opacity: 0.95;
        min-height: 44px;
        white-space: pre-wrap;
      }

      #panelActions{
        display:flex;
        gap: 8px;
        margin-top: 12px;
        flex-wrap: wrap; /* prevents overflow on narrow screens */
      }

      #panelActions button{
        flex: 1 1 110px;
        padding: 10px;
        border-radius: 10px;
        border: 1px solid rgba(255,255,255,0.25);
        background: rgba(255,255,255,0.08);
        color:#fff;
        cursor:pointer;
        touch-action: manipulation;
      }
      #panelActions button:disabled{ opacity: 0.4; cursor:not-allowed; }

      #panelFooter{ margin-top: 10px; font-size: 12px; opacity: 0.75; }

      /* Phones / tablet portrait: convert panel into a bottom sheet */
      @media (max-width: 860px){
        #panel{
          left: calc(var(--edge) + env(safe-area-inset-left));
          right: calc(var(--edge) + env(safe-area-inset-right));
          top: auto;
          bottom: calc(var(--edge) + env(safe-area-inset-bottom));
          width: auto;

          /* Don’t cover the whole camera view */
          max-height: min(46dvh, 520px);
        }
      }

      /* Very small phones */
      @media (max-width: 420px){
        #panel{ padding: 12px; }
        #panelActions button{ flex: 1 1 30%; }
      }
    </style>
  </head>

  <body>
    <div id="ar-ui">
      <div id="panel">
        <div id="panelHeader">
          <div id="cardTitle">Point at your card…</div>
          <div id="cardCategory"></div>
        </div>

        <div id="cardFacts">Waiting for target…</div>

        <div id="panelActions">
          <button id="btnPrev" type="button" disabled>Prev</button>
          <button id="btnNext" type="button" disabled>Next</button>
          <button id="btnCollect" type="button" disabled>Collect</button>
        </div>

        <div id="panelFooter">
          <span id="cardStatus">Waiting for target…</span>
        </div>
      </div>
    </div>

    <script type="module" src="/src/scan.ts"></script>
  </body>
</html>
